"""8x8 pixel font (7x7 usable pixels) based on Joystix font by typodermicfonts"""
try:
    from ssd1306 import send_data, set_page_address, set_column_address
except ImportError:
    pass

# Constants:
BIT_DOUBLER = (
    "\x00", "\x03", "\x0c", "\x0f", "\x30", "\x33", "\x3c", "\x3f",
    "\xc0", "\xc3", "\xcc", "\xcf", "\xf0", "\xf3", "\xfc", "\xff"
)
FONT_8X8 = (
    "\x7f\x7f\x41\x41\x41\x41\x41\x41",  # CUSTOM_00 battery 0 L
    "\x41\x41\x41\x41\x41\x7f\x3e\x00",  # CUSTOM_01 battery 0 R
    "\x7f\x7f\x6b\x41\x41\x41\x41\x41",  # CUSTOM_02 battery 1 L
    "\x7f\x7f\x6b\x55\x41\x41\x41\x41",  # CUSTOM_03 battery 2 L
    "\x7f\x7f\x6b\x55\x6b\x41\x41\x41",  # CUSTOM_04 battery 3 L
    "\x7f\x7f\x6b\x55\x6b\x55\x41\x41",  # CUSTOM_05 battery 4 L
    "\x7f\x7f\x6b\x55\x6b\x55\x6b\x41",  # CUSTOM_06 battery 5 L
    "\x7f\x7f\x6b\x55\x6b\x55\x6b\x55",  # CUSTOM_07 battery 6 L
    "\x6b\x41\x41\x41\x41\x7f\x3e\x00",  # CUSTOM_08 battery 7 R
    "\x6b\x55\x41\x41\x41\x7f\x3e\x00",  # CUSTOM_09 battery 8 R
    "\x6b\x55\x6b\x41\x41\x7f\x3e\x00",  # CUSTOM_0a battery 9 R
    "\x6b\x55\x6b\x55\x41\x7f\x3e\x00",  # CUSTOM_0b battery 10 R
    "\x6b\x55\x6b\x55\x6b\x7f\x3e\x00",  # CUSTOM_0c battery 11 R
    "\x40\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_0d 1 bar
    "\x50\x10\x10\x00\x00\x00\x00\x00",  # CUSTOM_0e 2 bars
    "\x54\x14\x14\x04\x04\x00\x00\x00",  # CUSTOM_0f 3 bars
    "\x55\x15\x15\x05\x05\x01\x01\x00",  # CUSTOM_10 4 bars
    "\x78\x44\x42\x41\x42\x44\x78\x00",  # CUSTOM_11 up arrow
    "\x0f\x11\x21\x41\x21\x11\x0f\x00",  # CUSTOM_12 down arrow
    "\x7f\x7f\x7f\x3e\x1c\x08\x00\x00",  # CUSTOM_13 right arrow
    "\x1e\x1f\x11\x55\x7d\x39\x11\x00",  # CUSTOM_14 link arrow
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_15
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_16
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_17
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_18
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_19
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_1a
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_1b
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_1c
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_1d
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_1e
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # CUSTOM_1f
    "\x00\x00\x00\x00\x00\x00\x00\x00",  # SPACE
    "\x00\x00\x40\x1C\x0F\x07\x03\x00",  # !
    "\x00\x00\x0B\x07\x00\x0B\x07\x00",  # "
    "\x00\x00\x14\x3E\x14\x3E\x14\x00",  # #
    "\x04\x2E\x2E\x6B\x3A\x3A\x10\x00",  # $
    "\x00\x23\x13\x08\x04\x32\x31\x00",  # %
    "\x30\x76\x49\x56\x20\x50\x40\x00",  # &
    "\x00\x00\x00\x00\x00\x0B\x07\x00",  # '
    "\x00\x00\x00\x00\x7E\xFF\x81\x00",  # (
    "\x81\xFF\x7E\x00\x00\x00\x00\x00",  # )
    "\x08\x2A\x1C\x7F\x1C\x2A\x08\x00",  # *
    "\x08\x08\x3E\x3E\x08\x08\x00\x00",  # +
    "\x00\x00\x00\x00\x00\xB0\x70\x00",  # ,
    "\x00\x00\x08\x08\x08\x08\x08\x00",  # -
    "\x00\x00\x00\x00\x00\x60\x60\x00",  # .
    "\x40\x20\x10\x08\x04\x02\x01\x00",  # /
    "\x1C\x3E\x61\x41\x43\x3E\x1C\x00",  # 0
    "\x00\x40\x42\x7F\x7F\x40\x40\x00",  # 1
    "\x62\x73\x79\x59\x5D\x4F\x46\x00",  # 2
    "\x20\x61\x49\x4D\x4F\x7B\x31\x00",  # 3
    "\x18\x1C\x16\x13\x7F\x7F\x10\x00",  # 4
    "\x27\x67\x45\x45\x45\x7D\x38\x00",  # 5
    "\x3C\x7E\x4B\x49\x49\x79\x30\x00",  # 6
    "\x03\x03\x71\x79\x0D\x07\x03\x00",  # 7
    "\x36\x4F\x4D\x59\x59\x76\x30\x00",  # 8
    "\x06\x4F\x49\x49\x69\x3F\x1E\x00",  # 9
    "\x00\x00\x36\x36\x00\x00\x00\x00",  # :
    "\x00\x00\xB6\x76\x00\x00\x00\x00",  # ;
    "\x00\x00\x08\x1C\x36\x63\x41\x00",  # <
    "\x00\x14\x14\x14\x14\x14\x14\x00",  # =
    "\x00\x00\x41\x63\x36\x1C\x08\x00",  # >
    "\x02\x03\x01\x59\x0D\x07\x06\x00",  # ?
    "\x3E\x7F\x41\x5D\x55\x5F\x0E\x00",  # @
    "\x7C\x7E\x13\x11\x13\x7E\x7C\x00",  # A
    "\x7F\x7F\x49\x49\x49\x7F\x36\x00",  # B
    "\x1C\x3E\x63\x41\x41\x63\x22\x00",  # C
    "\x7F\x7F\x41\x41\x63\x3E\x1C\x00",  # D
    "\x7F\x7F\x49\x49\x49\x49\x41\x00",  # E
    "\x7F\x7F\x09\x09\x09\x09\x01\x00",  # F
    "\x1C\x3E\x63\x41\x49\x79\x79\x00",  # G
    "\x7F\x7F\x08\x08\x08\x7F\x7F\x00",  # H
    "\x00\x41\x41\x7F\x7F\x41\x41\x00",  # I
    "\x20\x60\x40\x40\x40\x7F\x3F\x00",  # J
    "\x7F\x7F\x18\x3C\x76\x63\x41\x00",  # K
    "\x7F\x7F\x40\x40\x40\x40\x40\x00",  # L
    "\x7F\x7F\x0E\x1C\x0E\x7F\x7F\x00",  # M
    "\x7F\x7F\x0E\x1C\x38\x7F\x7F\x00",  # N
    "\x3E\x7F\x41\x41\x41\x7F\x3E\x00",  # O
    "\x7F\x7F\x11\x11\x11\x1F\x0E\x00",  # P
    "\x3E\x7F\x41\x51\x71\x3F\x5E\x00",  # Q
    "\x7F\x7F\x11\x31\x79\x6F\x4E\x00",  # R
    "\x26\x6F\x49\x49\x4B\x7B\x30\x00",  # S
    "\x00\x01\x01\x7F\x7F\x01\x01\x00",  # T
    "\x3F\x7F\x40\x40\x40\x7F\x3F\x00",  # U
    "\x0F\x1F\x38\x70\x38\x1F\x0F\x00",  # V
    "\x7F\x7F\x38\x1C\x38\x7F\x7F\x00",  # W
    "\x63\x77\x3E\x1C\x3E\x77\x63\x00",  # X
    "\x00\x07\x0F\x78\x78\x0F\x07\x00",  # Y
    "\x61\x71\x79\x5D\x4F\x47\x43\x00",  # Z
    "\x00\x00\x00\xFF\xFF\x81\x81\x00",  # [
    "\x01\x02\x04\x08\x10\x20\x40\x00",  # \
    "\x81\x81\xFF\xFF\x00\x00\x00\x00",  # ]
    "\x00\x00\x04\x06\x03\x06\x04\x00",  # ^
    "\x80\x80\x80\x80\x80\x80\x80\x00",  # _
    "\x00\x00\x00\x00\x01\x03\x02\x00",  # `
    "\x38\x7c\x44\x44\x48\x7c\x7c\x00",  # a
    "\x7f\x7f\x44\x44\x44\x7c\x38\x00",  # b
    "\x38\x7c\x44\x44\x44\x6c\x28\x00",  # c
    "\x38\x7c\x44\x44\x44\x7f\x7f\x00",  # d
    "\x38\x7c\x54\x54\x54\x5c\x58\x00",  # e
    "\x08\x08\x7e\x7f\x09\x09\x01\x00",  # f
    "\x0c\x1e\x92\x92\x96\xfc\x7e\x00",  # g
    "\x7f\x7f\x04\x04\x04\x7c\x78\x00",  # h
    "\x00\x00\x7d\x7d\x00\x00\x00\x00",  # i
    "\x40\xc0\x80\x80\x80\xfd\x7d\x00",  # j
    "\x7f\x7f\x10\x10\x28\x6c\x44\x00",  # k
    "\x00\x41\x41\x7f\x7f\x40\x40\x00",  # l
    "\x7c\x78\x04\x38\x04\x7c\x78\x00",  # m
    "\x7c\x78\x04\x04\x04\x7c\x78\x00",  # n
    "\x38\x7c\x44\x44\x44\x7c\x38\x00",  # o
    "\xfc\xfc\x24\x24\x24\x3c\x18\x00",  # p
    "\x18\x3c\x24\x24\x24\xfc\xfc\x00",  # q
    "\x7c\x78\x0c\x04\x04\x0c\x08\x00",  # r
    "\x08\x5c\x54\x54\x54\x74\x20\x00",  # s
    "\x04\x04\x3f\x7f\x44\x64\x20\x00",  # t
    "\x3c\x7c\x40\x40\x40\x3c\x7c\x00",  # u
    "\x0c\x1c\x30\x60\x30\x1c\x0c\x00",  # v
    "\x7c\x7c\x30\x18\x30\x7c\x7c\x00",  # w
    "\x44\x6c\x38\x10\x38\x6c\x44\x00",  # x
    "\x1c\xbc\xa0\xa0\xa0\xfc\x7c\x00",  # y
    "\x44\x64\x64\x54\x4c\x4c\x44\x00",  # z
    "\x00\x00\x00\x08\x3E\x77\x41\x00",  # {
    "\x00\x00\x00\xFF\xFF\x00\x00\x00",  # |
    "\x41\x77\x3E\x08\x00\x00\x00\x00",  # }
    "\x00\x10\x08\x08\x10\x10\x08\x00",  # ~
)

BATTERY_CHARS = (
    "\x00\x01",  # 0%
    "\x02\x01",  # 9%
    "\x03\x01",  # 18%
    "\x04\x01",  # 27%
    "\x05\x01",  # 36%
    "\x06\x01",  # 45%
    "\x07\x01",  # 55%
    "\x07\x08",  # 64%
    "\x07\x09",  # 73%
    "\x07\x0a",  # 82%
    "\x07\x0b",  # 91%
    "\x07\x0c"  # 100%
)

SIGNAL_CHAR = (
    "\x20",  # 0 bars
    "\x0d",  # 1 bar
    "\x0e",  # 2 bars
    "\x0f",  # 3 bars
    "\x10"  # 4 bars
)

UP_ARROW = "\x11"
DOWN_ARROW = "\x12"
RIGHT_ARROW = "\x13"
LINK_ARROW = "\x14"

# Globals:
G_DRAW_X = 0
G_DRAW_Y = 0


def set_xy(x, y):
    global G_DRAW_X, G_DRAW_Y

    G_DRAW_X = x
    G_DRAW_Y = y


def print_8x8(string):
    """Prints the given string using a 8x8 pixel font.

    :param str string: String to print
    """
    global G_DRAW_X

    # Top half
    set_page_address(G_DRAW_Y * 2, 7)
    set_column_address(G_DRAW_X * 8, 127)
    for character in string:
        index = ord(character)

        # Unknown characters are replaced with space:
        input_data = FONT_8X8[32 if index > len(FONT_8X8) else index]

        # Double the top half
        for column_data in input_data:
            send_data(BIT_DOUBLER[ord(column_data) & 0x0f])

    # Bottom half
    set_page_address((G_DRAW_Y * 2) + 1, 7)
    set_column_address(G_DRAW_X * 8, 127)
    for character in string:
        index = ord(character)

        # Unknown characters are replaced with CUSTOM_00:
        input_data = FONT_8X8[0 if index > len(FONT_8X8) else index]

        # Double the top half
        for column_data in input_data:
            send_data(BIT_DOUBLER[ord(column_data) >> 4])

    G_DRAW_X += len(string)
